function rnd_hex(){return Math.ceil(9*Math.random())}function rnd_color(){for(var t="0123456789ABCDEF".split(""),e="#",i=0;6>i;i++)e+=t[Math.floor(16*Math.random())];return e="#fff"}var isAndroid="android"===Ti.Platform.osname,pubnub=require("pubnub")({publish_key:"pub-c-7d4ecd31-94b0-473b-b95c-705ed503fe69",subscribe_key:"sub-c-e46c256e-7a9c-11e4-b197-02ee2ddab7fe",ssl:!1,origin:"pubsub.pubnub.com"}),sound=Titanium.Media.createSound({url:"chime.wav",preload:!0});Ti.App.Chat=function(t){function e(i){i&&pubnub.publish({channel:t["chat-room"],message:{text:i,color:"white"},callback:function(t){t[0]||setTimeout(function(){e(i)},2e3)}})}function i(t,e){var i=Ti.UI.createTableViewRow({className:"pubnub_chat",backgroundGradient:{type:"linear",colors:["#fff","#eeeeed"],startPoint:{x:0,y:0},endPoint:{x:0,y:70},backFillStart:!1}}),n=Ti.UI.createLabel({text:t||"no-message",height:isAndroid?"50dp":"auto",width:"auto",color:e||"#111",left:10,font:{fontSize:isAndroid?"19dp":14,fontWeight:isAndroid?"bold":"normal"}});i.add(n),a.insertRowBefore(0,i)}pubnub.subscribe({channel:t["chat-room"],connect:function(){i("Entered Chat...","white")},callback:function(t){i(t.text,t.color),sound.play()},error:function(){i("Lost Connection...","red")}});var n=Ti.UI.createWindow(t.window),o=Ti.UI.createTextField({width:isAndroid?"75%":247,height:isAndroid?"50dp":30,left:4,top:4,color:"#fff",value:"",border:1,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,borderRadius:4,font:{fontSize:isAndroid?"18dp":14,fontWeight:"bold"}}),a=Ti.UI.createTableView({separatorColor:isAndroid?"green":"#fff",top:isAndroid?"60dp":40,height:"80%"}),d=Ti.UI.createButton({title:"Send",top:4,right:4,width:isAndroid?"70dp":60,height:isAndroid?"50dp":30,borderRadius:6,shadowColor:"#001",shadowOffset:{x:1,y:1},style:Ti.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontSize:isAndroid?"18dp":16,fontWeight:"bold"},backgroundGradient:{type:"linear",colors:["#058cf5","#015fe6"],startPoint:{x:0,y:0},endPoint:{x:2,y:50},backFillStart:!1}});return a.appendRow(Ti.UI.createTableViewRow({className:"pubnub_chat"})),d.addEventListener("touchstart",function(){e(o.value),o.value="",o.focus()}),o.addEventListener("return",function(){e(o.value),o.value="",o.focus()}),n.addEventListener("open",function(){o.focus()}),n.add(a),n.add(d),n.add(o),this.chat_window=n,this.my_color=rnd_color(),this.pubnub=pubnub,i(" "),i(" "),i(" "),i("Connecting...","white"),this};